<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Leading Light ‚Äì Safety Navigation</title>
  <meta name="description" content="A safety-focused navigation prototype.">
  <meta name="theme-color" content="#0A0A14">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="images/icon-192.png">
  <link rel="apple-touch-icon" href="images/icon-192.png">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

<!-- ========== SPLASH SCREEN ========== -->
<div id="splashScreen" class="screen splash">
  <div class="splash__icon">
    <svg viewBox="0 0 64 64" fill="none">
      <circle cx="32" cy="32" r="28" stroke="#6C63FF" stroke-width="3" opacity="0.25"/>
      <circle cx="32" cy="32" r="16" stroke="#6C63FF" stroke-width="3" opacity="0.5"/>
      <circle cx="32" cy="32" r="6" fill="#6C63FF"/>
    </svg>
  </div>
  <h1 class="splash__title">Leading Light</h1>
  <p class="splash__sub">Stay safe, stay connected</p>
</div>

<!-- ========== WELCOME SCREEN ========== -->
<div id="welcomeScreen" class="screen welcome" style="display:none">
  <div class="welcome__hero">
    <div class="welcome__map-preview">
      <svg viewBox="0 0 200 200" fill="none">
        <rect width="200" height="200" rx="20" fill="#161625"/>
        <path d="M40 160 L80 80 L120 120 L160 40" stroke="#6C63FF" stroke-width="3" stroke-linecap="round" opacity="0.6"/>
        <circle cx="80" cy="80" r="6" fill="#6C63FF" opacity="0.7"/>
        <circle cx="120" cy="120" r="6" fill="#6C63FF" opacity="0.7"/>
        <circle cx="100" cy="100" r="10" fill="#6C63FF"/>
        <circle cx="100" cy="100" r="16" stroke="#6C63FF" stroke-width="2" opacity="0.3"/>
      </svg>
    </div>
  </div>
  <div class="welcome__content">
    <h2 class="welcome__title">Navigate Safely</h2>
    <p class="welcome__desc">Real-time safety alerts, community reports, and smart route suggestions to help you get home safe.</p>
    <button class="btn-primary" id="welcomeGetStarted">Get Started</button>
    <p class="welcome__login-link">Already have an account? <a href="#" id="welcomeToLogin">Log In</a></p>
    <a href="#" class="welcome__skip" id="welcomeSkip">Skip for now ‚Üí</a>
  </div>
</div>

<!-- ========== LOGIN SCREEN ========== -->
<div id="loginScreen" class="screen auth-screen" style="display:none">
  <button class="screen-back" id="loginBack" aria-label="Back">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
  </button>
  <div class="auth-screen__body">
    <h2 class="auth-screen__title">Log In</h2>
    <p class="auth-screen__sub">Welcome back! Enter your details.</p>
    <div class="auth-error" id="loginError"></div>
    <form id="loginForm" class="auth-form" autocomplete="off">
      <label class="form-field">
        <span class="form-field__label">Email</span>
        <input type="email" class="form-field__input" id="loginEmail" placeholder="you@example.com" required>
      </label>
      <label class="form-field">
        <span class="form-field__label">Password</span>
        <input type="password" class="form-field__input" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
      </label>
      <a href="#" class="auth-form__forgot" id="loginForgotLink">Forgot password?</a>
      <button type="submit" class="btn-primary" id="loginSubmitBtn">Log In</button>
    </form>
    <p class="auth-screen__switch">Don't have an account? <a href="#" id="loginToSignup">Sign Up</a></p>
    <a href="#" class="auth-screen__skip" id="loginSkip">Skip for now ‚Üí</a>
  </div>
</div>

<!-- ========== SIGN UP SCREEN ========== -->
<div id="signupScreen" class="screen auth-screen" style="display:none">
  <button class="screen-back" id="signupBack" aria-label="Back">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
  </button>
  <div class="auth-screen__body">
    <h2 class="auth-screen__title">Sign Up</h2>
    <p class="auth-screen__sub">Create an account to stay safe.</p>
    <div class="auth-error" id="signupError"></div>
    <form id="signupForm" class="auth-form" autocomplete="off">
      <label class="form-field">
        <span class="form-field__label">Full Name</span>
        <input type="text" class="form-field__input" id="signupName" placeholder="Jane Doe" required>
      </label>
      <label class="form-field">
        <span class="form-field__label">Email</span>
        <input type="email" class="form-field__input" id="signupEmail" placeholder="you@example.com" required>
      </label>
      <label class="form-field">
        <span class="form-field__label">Password</span>
        <input type="password" class="form-field__input" id="signupPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
      </label>
      <label class="form-field">
        <span class="form-field__label">Confirm Password</span>
        <input type="password" class="form-field__input" id="signupConfirmPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
      </label>
      <button type="submit" class="btn-primary" id="signupSubmitBtn">Create Account</button>
    </form>
    <p class="auth-screen__switch">Already have an account? <a href="#" id="signupToLogin">Log In</a></p>
    <a href="#" class="auth-screen__skip" id="signupSkip">Skip for now ‚Üí</a>
  </div>
</div>

<!-- ========== FORGOT PASSWORD SCREEN ========== -->
<div id="forgotPasswordScreen" class="screen auth-screen" style="display:none">
  <button class="screen-back" id="forgotPasswordBack" aria-label="Back">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
  </button>
  <div class="auth-screen__body">
    <h2 class="auth-screen__title">Reset Password</h2>
    <p class="auth-screen__sub">Enter your email and choose a new password.</p>
    <div class="auth-error" id="forgotError"></div>
    <form id="forgotPasswordForm" class="auth-form" autocomplete="off">
      <label class="form-field">
        <span class="form-field__label">Email</span>
        <input type="email" class="form-field__input" id="forgotEmail" placeholder="you@example.com" required>
      </label>
      <label class="form-field">
        <span class="form-field__label">New Password</span>
        <input type="password" class="form-field__input" id="forgotNewPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
      </label>
      <label class="form-field">
        <span class="form-field__label">Confirm New Password</span>
        <input type="password" class="form-field__input" id="forgotConfirmPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
      </label>
      <button type="submit" class="btn-primary">Reset Password</button>
    </form>
    <p class="auth-screen__switch">Remember your password? <a href="#" id="forgotToLogin">Log In</a></p>
  </div>
</div>

<!-- ========== MAIN APP (Map) ========== -->
<div id="mainApp" class="screen" style="display:none">
  <div class="app">

    <!-- Top search bar -->
    <header class="topbar">
      <button class="topbar__avatar" id="topbarAvatar" aria-label="Profile">
        <span id="topbarAvatarText">JD</span>
      </button>
      <div class="topbar__search" id="searchBar">
        <input type="text" class="topbar__search-input" id="searchInput" placeholder="Search location‚Ä¶" autocomplete="off">
        <button class="topbar__clear" id="searchClear" aria-label="Clear search">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- Search suggestions -->
    <div class="search-suggestions" id="searchSuggestions"></div>

    <!-- Map -->
    <div id="map" class="map"></div>

    <!-- Bottom sheet -->
    <div class="bottom-sheet hidden" id="bottomSheet">
      <div class="bottom-sheet__handle" id="sheetHandle"></div>
      <div class="bottom-sheet__body">
        <h3 class="bottom-sheet__title" id="sheetTitle"></h3>
        <p class="bottom-sheet__desc" id="sheetDesc"></p>
        <div class="bottom-sheet__meta">
          <span class="bottom-sheet__meta-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            <span id="sheetTime"></span>
          </span>
          <span class="bottom-sheet__meta-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/>
            </svg>
            <span id="sheetDistance"></span>
          </span>
        </div>
        <button class="bottom-sheet__cta" id="sheetRouteBtn">Get the Route</button>
      </div>
    </div>

    <!-- Route panel -->
    <div class="route-panel" id="routePanel">
      <div class="route-panel__handle"></div>
      <div class="route-panel__header">
        <h2 class="route-panel__title">Route Options</h2>
        <button class="route-panel__close" id="routePanelClose" aria-label="Close routes">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
      </div>
      <div class="route-panel__options" id="routeOptions"></div>
      <button class="route-panel__start" id="routeStartNav">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
        Start Navigation
      </button>
    </div>

    <!-- Full-screen turn-by-turn directions page -->
    <div class="directions-page" id="directionsPage">
      <!-- Header -->
      <div class="directions-page__header">
        <button class="directions-page__back" id="directionsBack" aria-label="Back to map">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
        </button>
        <div class="directions-page__title-group">
          <h2 class="directions-page__title" id="directionsTitle">Directions</h2>
          <span class="directions-page__subtitle" id="directionsSubtitle"></span>
        </div>
        <button class="directions-page__end" id="directionsEnd">End</button>
      </div>

      <!-- Route summary bar -->
      <div class="directions-page__summary">
        <div class="directions-page__stat">
          <span class="directions-page__stat-value directions-page__stat-value--time" id="dirTime">--</span>
          <span class="directions-page__stat-label">Duration</span>
        </div>
        <div class="directions-page__stat-divider"></div>
        <div class="directions-page__stat">
          <span class="directions-page__stat-value" id="dirDist">--</span>
          <span class="directions-page__stat-label">Distance</span>
        </div>
        <div class="directions-page__stat-divider"></div>
        <div class="directions-page__stat">
          <div class="directions-page__safety" id="dirSafety">
            <span class="directions-page__safety-score" id="dirSafetyScore">--</span>
          </div>
          <span class="directions-page__stat-label">Safety</span>
        </div>
      </div>

      <!-- Current / next maneuver hero -->
      <div class="directions-page__hero" id="dirHero">
        <div class="directions-page__hero-icon" id="dirHeroIcon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="12 19 12 5"/><polyline points="5 12 12 5 19 12"/></svg>
        </div>
        <div class="directions-page__hero-info">
          <span class="directions-page__hero-instruction" id="dirHeroInstruction">Start walking</span>
          <span class="directions-page__hero-dist" id="dirHeroDist"></span>
        </div>
      </div>

      <!-- Full step list -->
      <div class="directions-page__steps" id="dirSteps"></div>

      <!-- Bottom action -->
      <div class="directions-page__footer">
        <button class="directions-page__map-btn" id="directionsShowMap">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/><line x1="8" y1="2" x2="8" y2="18"/><line x1="16" y1="6" x2="16" y2="22"/></svg>
          Show on Map
        </button>
      </div>
    </div>

    <!-- Sharing location banner -->
    <div class="share-banner" id="shareBanner" style="display:none">
      <div class="share-banner__icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="#6C63FF" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
      </div>
      <div class="share-banner__info">
        <span class="share-banner__name" id="shareContactName">Mom</span>
        <span class="share-banner__status">Sharing your location‚Ä¶</span>
      </div>
      <button class="share-banner__stop" id="shareStop">Stop</button>
    </div>

    <!-- Report FAB -->
    <button class="report-fab" id="reportBtn" aria-label="Report safety concern">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/>
        <line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
      </svg>
    </button>

    <!-- Locate / Homing button -->
    <button class="locate-fab" id="locateBtn" aria-label="Center on my location">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="3"/>
        <line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/>
        <line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/>
      </svg>
    </button>

    <!-- Bottom Navigation Bar -->
    <nav class="bottom-nav" id="bottomNav">
      <button class="bottom-nav__item bottom-nav__item--active" data-tab="map">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>
        <span>Explore</span>
      </button>
      <button class="bottom-nav__item" data-tab="share">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
        <span>Share</span>
      </button>
      <button class="bottom-nav__item bottom-nav__item--sos" data-tab="sos" id="sosBtn">
        <div class="bottom-nav__sos-ring"></div>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6A19.79 19.79 0 012.12 4.18 2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/></svg>
        <span>SOS</span>
      </button>
      <button class="bottom-nav__item" data-tab="contacts">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4-4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
        <span>Contacts</span>
      </button>
      <button class="bottom-nav__item" data-tab="settings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
        <span>More</span>
      </button>
    </nav>

    <!-- ===== MODALS ===== -->

    <!-- Report modal -->
    <div class="modal-overlay" id="reportModal">
      <div class="modal">
        <div class="modal__header">
          <h2 class="modal__title">Report Safety Concern</h2>
          <button class="modal__close" id="reportModalClose" aria-label="Close">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
        <p class="modal__desc">Tap a category to quickly flag this area.</p>
        <div class="report-grid" id="report-grid">
          <button class="report-option" data-category="poor-lighting"><span class="report-option__icon">üî¶</span><span class="report-option__label">Poor Lighting</span></button>
          <button class="report-option" data-category="harassment"><span class="report-option__icon">‚ö†Ô∏è</span><span class="report-option__label">Harassment</span></button>
          <button class="report-option" data-category="unsafe-road"><span class="report-option__icon">üöß</span><span class="report-option__label">Unsafe Road</span></button>
          <button class="report-option" data-category="suspicious"><span class="report-option__icon">üëÅÔ∏è</span><span class="report-option__label">Suspicious</span></button>
          <button class="report-option" data-category="closed-path"><span class="report-option__icon">üö´</span><span class="report-option__label">Closed Path</span></button>
          <button class="report-option" data-category="other"><span class="report-option__icon">üìù</span><span class="report-option__label">Other</span></button>
        </div>
        <div class="report-confirm" id="report-confirm">
          <span class="report-confirm__icon">‚úÖ</span>
          <p class="report-confirm__text">Thank you! Report submitted.</p>
        </div>
      </div>
    </div>

    <!-- SOS modal -->
    <div class="modal-overlay" id="sosModal">
      <div class="modal modal--sos">
        <div class="modal__header">
          <h2 class="modal__title">Emergency Alert</h2>
          <button class="modal__close" id="sosModalClose" aria-label="Close">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
        <div class="sos-content">
          <div class="sos-emergency-type" id="sosEmergencyType">
            <p style="color:var(--text-m);font-size:13px;margin-bottom:8px;">Emergency type:</p>
            <div style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px;">
              <button type="button" class="sos-type-btn active" data-type="I need help">üÜò General</button>
              <button type="button" class="sos-type-btn" data-type="Being followed">üëÅÔ∏è Followed</button>
              <button type="button" class="sos-type-btn" data-type="Medical emergency">üè• Medical</button>
              <button type="button" class="sos-type-btn" data-type="Feeling unsafe">‚ö†Ô∏è Unsafe</button>
              <button type="button" class="sos-type-btn" data-type="Car accident">üöó Accident</button>
              <button type="button" class="sos-type-btn" data-type="Assault or threat">üö® Threat</button>
            </div>
          </div>

          <!-- Swipe to send slider (shown first) -->
          <div class="sos-swipe" id="sosSwipeContainer">
            <div class="sos-swipe__track" id="sosSwipeTrack">
              <div class="sos-swipe__thumb" id="sosSwipeThumb">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
              </div>
              <span class="sos-swipe__label" id="sosSwipeLabel">Swipe to send alert</span>
              <div class="sos-swipe__fill" id="sosSwipeFill"></div>
            </div>
          </div>

          <!-- Countdown (hidden until swipe confirmed) -->
          <div class="sos-countdown" id="sosCountdownContent" style="display:none">
            <span class="sos-countdown__number" id="sosCountdownNumber">5</span>
            <span class="sos-countdown__label">Sending alert in‚Ä¶</span>
          </div>

          <p class="sos-content__text">Your location &amp; emergency type will be emailed to your contacts.</p>
          <div class="sos-contacts" id="sosContactsList">
            <!-- filled by JS from contacts store -->
          </div>
          <button class="btn btn--danger btn--full" id="sosSendNow" style="display:none">Send Now</button>
          <button class="btn btn--ghost btn--full" id="sosCancel">Cancel</button>
          <div class="sos-sent" id="sosSent">
            <span class="sos-sent__icon">üì°</span>
            <p class="sos-sent__text">Alert sent! Contacts notified.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Share location modal -->
    <div class="modal-overlay" id="shareModal">
      <div class="modal">
        <div class="modal__header">
          <h2 class="modal__title">Share Location</h2>
          <button class="modal__close" id="shareModalClose" aria-label="Close">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
        <p class="modal__desc">Choose a contact to share your live location with.</p>
        <div class="share-contact-list" id="shareContactList">
          <!-- filled by JS -->
        </div>
      </div>
    </div>

  </div><!-- /.app -->
</div><!-- /#mainApp -->

<!-- ========== SETTINGS SCREEN ========== -->
<div id="settingsScreen" class="screen page-screen" style="display:none">
  <div class="page-header">
    <button class="screen-back" id="settingsBack" aria-label="Back">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <h2 class="page-header__title">Settings</h2>
  </div>
  <div class="page-body">
    <div class="settings-list">
      <button class="settings-item" data-goto="profileSettings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4-4v2"/><circle cx="12" cy="7" r="4"/></svg>
        <span>Profile Settings</span>
        <svg class="settings-item__arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
      </button>
      <button class="settings-item" data-goto="notifSettings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
        <span>Notifications</span>
        <svg class="settings-item__arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
      </button>
      <button class="settings-item" data-goto="passwordSettings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
        <span>Change Password</span>
        <svg class="settings-item__arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
      </button>
      <button class="settings-item" data-goto="contacts">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4-4v2"/><circle cx="9" cy="7" r="4"/></svg>
        <span>Emergency Contacts</span>
        <svg class="settings-item__arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
      </button>
      <button class="settings-item" data-goto="feedbackScreen">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
        <span>Leave Feedback</span>
        <svg class="settings-item__arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
      </button>
      <button class="settings-item settings-item--danger" id="settingsDeleteAccountBtn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
        <span>Delete Account</span>
        <svg class="settings-item__arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
      </button>
      <button class="settings-item settings-item--logout" id="settingsLogoutBtn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        <span>Log Out</span>
      </button>
    </div>
  </div>
</div>

<!-- ========== PROFILE SETTINGS ========== -->
<div id="profileSettings" class="screen page-screen" style="display:none">
  <div class="page-header">
    <button class="screen-back" id="profileBack" aria-label="Back">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <h2 class="page-header__title">Profile</h2>
  </div>
  <div class="page-body">
    <div class="profile-avatar-section">
      <div class="profile-avatar" id="profileAvatarDisplay">JD</div>
      <button class="profile-avatar-edit">Edit Photo</button>
    </div>
    <form class="auth-form" id="profileForm">
      <label class="form-field">
        <span class="form-field__label">Full Name</span>
        <input type="text" class="form-field__input" id="profileName" value="Jane Doe">
      </label>
      <label class="form-field">
        <span class="form-field__label">Email</span>
        <input type="email" class="form-field__input" id="profileEmail" value="jane@example.com">
      </label>
      <label class="form-field">
        <span class="form-field__label">Phone</span>
        <input type="tel" class="form-field__input" id="profilePhone" value="+1 (555) 000-0000">
      </label>
      <button type="submit" class="btn-primary">Save Changes</button>
    </form>
  </div>
</div>

<!-- ========== NOTIFICATION SETTINGS ========== -->
<div id="notifSettings" class="screen page-screen" style="display:none">
  <div class="page-header">
    <button class="screen-back" id="notifBack" aria-label="Back">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <h2 class="page-header__title">Notifications</h2>
  </div>
  <div class="page-body">
    <div class="settings-list">
      <label class="toggle-item">
        <span>Safety Alerts</span>
        <input type="checkbox" class="toggle-input" checked>
        <span class="toggle-slider"></span>
      </label>
      <label class="toggle-item">
        <span>Community Reports</span>
        <input type="checkbox" class="toggle-input" checked>
        <span class="toggle-slider"></span>
      </label>
      <label class="toggle-item">
        <span>Route Updates</span>
        <input type="checkbox" class="toggle-input" checked>
        <span class="toggle-slider"></span>
      </label>
      <label class="toggle-item">
        <span>Location Sharing</span>
        <input type="checkbox" class="toggle-input">
        <span class="toggle-slider"></span>
      </label>
      <label class="toggle-item">
        <span>Emergency SOS</span>
        <input type="checkbox" class="toggle-input" checked>
        <span class="toggle-slider"></span>
      </label>
      <label class="toggle-item">
        <span>Sound</span>
        <input type="checkbox" class="toggle-input" checked>
        <span class="toggle-slider"></span>
      </label>
      <label class="toggle-item">
        <span>Vibration</span>
        <input type="checkbox" class="toggle-input" checked>
        <span class="toggle-slider"></span>
      </label>
    </div>
  </div>
</div>

<!-- ========== CHANGE PASSWORD ========== -->
<div id="passwordSettings" class="screen page-screen" style="display:none">
  <div class="page-header">
    <button class="screen-back" id="passwordBack" aria-label="Back">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <h2 class="page-header__title">Change Password</h2>
  </div>
  <div class="page-body">
    <div class="auth-error" id="passwordError"></div>
    <form class="auth-form" id="passwordForm">
      <label class="form-field">
        <span class="form-field__label">Current Password</span>
        <input type="password" class="form-field__input" id="currentPasswordInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
      </label>
      <label class="form-field">
        <span class="form-field__label">New Password</span>
        <input type="password" class="form-field__input" id="newPasswordInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
      </label>
      <label class="form-field">
        <span class="form-field__label">Confirm New Password</span>
        <input type="password" class="form-field__input" id="confirmNewPasswordInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
      </label>
      <button type="submit" class="btn-primary" id="passwordSubmitBtn">Update Password</button>
    </form>
  </div>
</div>

<!-- ========== EMERGENCY CONTACTS ========== -->
<div id="contactsScreen" class="screen page-screen" style="display:none">
  <div class="page-header">
    <button class="screen-back" id="contactsBack" aria-label="Back">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <h2 class="page-header__title">Emergency Contacts</h2>
  </div>
  <div class="page-body">
    <div class="contacts-list" id="contactsList">
      <!-- filled by JS -->
    </div>
    <button class="btn-primary btn-primary--outline" id="addContactBtn">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:18px;height:18px;margin-right:8px"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      Add Contact
    </button>
  </div>
</div>

<!-- ========== ADD/EDIT CONTACT ========== -->
<div id="contactFormScreen" class="screen page-screen" style="display:none">
  <div class="page-header">
    <button class="screen-back" id="contactFormBack" aria-label="Back">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <h2 class="page-header__title" id="contactFormTitle">Add Contact</h2>
  </div>
  <div class="page-body">
    <form class="auth-form" id="contactForm">
      <label class="form-field">
        <span class="form-field__label">Name</span>
        <input type="text" class="form-field__input" id="contactNameInput" placeholder="Contact name" required>
      </label>
      <label class="form-field">
        <span class="form-field__label">Phone Number</span>
        <input type="tel" class="form-field__input" id="contactPhoneInput" placeholder="+1 (555) 000-0000" required>
      </label>
      <label class="form-field">
        <span class="form-field__label">Email</span>
        <input type="email" class="form-field__input" id="contactEmailInput" placeholder="contact@email.com">
      </label>
      <label class="form-field">
        <span class="form-field__label">Relationship</span>
        <input type="text" class="form-field__input" id="contactRelInput" placeholder="e.g. Mom, Roommate">
      </label>
      <button type="submit" class="btn-primary" id="contactFormSubmit">Save Contact</button>
    </form>
  </div>
</div>

<!-- ========== LEAVE FEEDBACK ========== -->
<div id="feedbackScreen" class="screen page-screen" style="display:none">
  <div class="page-header">
    <button class="screen-back" id="feedbackBack" aria-label="Back">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <h2 class="page-header__title">Leave Feedback</h2>
  </div>
  <div class="page-body">
    <p class="page-body__desc">We'd love to hear your thoughts! Help us improve Leading Light.</p>
    <form class="auth-form" id="feedbackForm">
      <label class="form-field">
        <span class="form-field__label">How would you rate your experience?</span>
        <div class="star-rating" id="starRating">
          <button type="button" class="star" data-val="1">‚òÖ</button>
          <button type="button" class="star" data-val="2">‚òÖ</button>
          <button type="button" class="star" data-val="3">‚òÖ</button>
          <button type="button" class="star" data-val="4">‚òÖ</button>
          <button type="button" class="star" data-val="5">‚òÖ</button>
        </div>
      </label>
      <label class="form-field">
        <span class="form-field__label">Your Feedback</span>
        <textarea class="form-field__input form-field__textarea" rows="5" placeholder="Tell us what you think‚Ä¶"></textarea>
      </label>
      <button type="submit" class="btn-primary">Submit Feedback</button>
    </form>
  </div>
</div>

<!-- ========== SCRIPTS ========== -->
<!-- On-screen debug log (tap toggle button to show/hide) -->
<div id="debugToggle" style="position:fixed;top:8px;right:8px;z-index:99999;width:36px;height:36px;border-radius:50%;background:rgba(108,99,255,.85);color:#fff;font-size:16px;font-weight:700;display:flex;align-items:center;justify-content:center;cursor:pointer;border:none;box-shadow:0 2px 8px rgba(0,0,0,.4);-webkit-tap-highlight-color:transparent" onclick="document.getElementById('debugPanel').style.display=document.getElementById('debugPanel').style.display==='none'?'flex':'none'">üêõ</div>
<div id="debugPanel" style="display:none;position:fixed;top:50px;left:8px;right:8px;bottom:100px;z-index:99998;background:rgba(10,10,20,.95);border:1px solid rgba(108,99,255,.3);border-radius:12px;flex-direction:column;font-family:monospace;font-size:11px;overflow:hidden">
  <div style="padding:8px 12px;background:rgba(108,99,255,.15);display:flex;justify-content:space-between;align-items:center;flex-shrink:0">
    <span style="color:#8B83FF;font-weight:700">Debug Log</span>
    <button onclick="document.getElementById('debugLog').innerHTML='';document.getElementById('debugCount').textContent='0'" style="background:none;border:1px solid rgba(255,255,255,.2);border-radius:6px;color:#aaa;padding:2px 8px;font-size:10px;cursor:pointer">Clear</button>
  </div>
  <div id="debugLog" style="flex:1;overflow-y:auto;padding:8px;color:#ccc;line-height:1.5;word-break:break-all"></div>
  <div style="padding:4px 12px;border-top:1px solid rgba(255,255,255,.06);color:#666;font-size:10px">Entries: <span id="debugCount">0</span></div>
</div>
<script>
(function(){
  const log = document.getElementById('debugLog');
  const count = document.getElementById('debugCount');
  let n = 0;
  function addEntry(level, args) {
    if (!log) return;
    const t = new Date().toLocaleTimeString('en-US',{hour12:false,hour:'2-digit',minute:'2-digit',second:'2-digit'});
    const colors = { log:'#ccc', warn:'#FFD600', error:'#FF3D71', info:'#6C63FF' };
    const msg = Array.from(args).map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' ');
    const div = document.createElement('div');
    div.style.cssText = `padding:3px 0;border-bottom:1px solid rgba(255,255,255,.04);color:${colors[level]||'#ccc'}`;
    div.textContent = `[${t}] ${level.toUpperCase()}: ${msg}`;
    log.appendChild(div);
    log.scrollTop = log.scrollHeight;
    n++; if(count) count.textContent = n;
  }
  const orig = { log:console.log, warn:console.warn, error:console.error, info:console.info };
  ['log','warn','error','info'].forEach(level => {
    console[level] = function(){
      orig[level].apply(console, arguments);
      addEntry(level, arguments);
    };
  });
  window.addEventListener('error', e => addEntry('error', [`Uncaught: ${e.message} at ${e.filename}:${e.lineno}`]));
  window.addEventListener('unhandledrejection', e => addEntry('error', [`Unhandled rejection: ${e.reason}`]));
})();
</script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="js/auth.js"></script>
<script src="js/map.js"></script>
<script src="js/routes.js"></script>
<script src="js/emergency.js"></script>
<script src="js/reports.js"></script>
<script src="js/app.js"></script>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').catch(() => {});
  }
</script>

</body>
</html>
